generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  STARTUP
  INVESTOR
}

model User {
  id             Int         @id @default(autoincrement())
  name           String
  email          String      @unique
  password       String      // Required for auth
  role           UserRole    @default(INVESTOR)
  organizationId Int?
  organization   Organization? @relation(fields: [organizationId], references: [id])
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  leads          Lead[]      @relation("AddedByUser")

  @@map("users")
}

model Organization {
  id            Int            @id @default(autoincrement())
  name          String
  type          String         // "startup" or "investor"
  website       String?
  region        String?
  contact       String?
  users         User[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  dealStartups  DealStartup[]
  dealInvestors DealInvestor[]

  @@map("organizations")
}

model Lead {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  domain    String?
  status    String   @default("new")
  addedById Int
  addedBy   User     @relation("AddedByUser", fields: [addedById], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("leads")
}

enum DealStage {
  NEW
  NEGOTIATING
  DUE_DILIGENCE
  CLOSED
}

enum DealStatus {
  ACTIVE
  LOST
  WON
}

model Deal {
  id        Int           @id @default(autoincrement())
  amount    Float?
  stage     DealStage     @default(NEW)
  status    DealStatus    @default(ACTIVE)
  startups  DealStartup[]
  investors DealInvestor[]
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@map("deals")
}

model DealStartup {
  id     Int    @id @default(autoincrement())
  dealId Int
  orgId  Int
  deal   Deal   @relation(fields: [dealId], references: [id], onDelete: Cascade)
  org    Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)

  @@unique([dealId, orgId])
  @@map("deal_startups")
}

model DealInvestor {
  id     Int    @id @default(autoincrement())
  dealId Int
  orgId  Int
  deal   Deal   @relation(fields: [dealId], references: [id], onDelete: Cascade)
  org    Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)

  @@unique([dealId, orgId])
  @@map("deal_investors")
}